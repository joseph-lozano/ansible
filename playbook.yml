- name: Setup Development Environment for Ubuntu VPS
  hosts: localhost
  become: yes
  vars:
    username: joseph

  tasks:
    - name: Ensure the user 'joseph' is present
      ansible.builtin.user:
        name: "{{ username }}"
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34353030353838343861666561366563643033303462353535383063376536313366303934636161
          6661393831393963336639623433323338663764346130300a313739346430343536646534346330
          61636530353463326433336339363237326366633931326632353138643533656135646263623136
          6361636230636630340a353939343333356134396634623539616335323632656236373335653764
          6662
        shell: /bin/bash
        create_home: yes
        state: present
        comment: "Joseph's user account"

    # Optional: Set up sudo privileges for the user
    - name: Give 'joseph' sudo privileges
      ansible.builtin.lineinfile:
        path: /etc/sudoers
        line: "{{ username }} ALL=(ALL) NOPASSWD:ALL"
        validate: visudo -cf %s
        state: present
    
    # Create .ssh directory for Joseph
    - name: Create .ssh directory for Joseph
      ansible.builtin.file:
        path: "/home/{{ username }}/.ssh"
        state: directory
        mode: '0700'
        owner: "{{ username }}"
        group: "{{ username }}"

    # Deploy SSH private key for Joseph
    - name: Deploy encrypted SSH private key for Joseph
      ansible.builtin.copy:
        content: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30323639373663346430373833336337316231323364633839323237336537636564333765666134
          6134383937613831613338306335643832393462653830610a653832313364353364666163646663
          62653932663965356334626662623565663234343261323830313139386261363965333063303034
          3338303037326238340a303534646661653635373730383238346230366262353665393739313832
          34363365343834643530323736633434393533313433336265633366386139343933346265613936
          61303036326236316466396430383836613431326131616434336164306663616438643235326132
          30303137656365373832373332383238393836623834343037373637663666363866336266653138
          32356562333163333230396361653230643733326130646561303039306539356330306166653534
          35343861653066656265313465633764646566633365343166353238616236313036306630393738
          65303337613566396365623238353238636363386666626163646239326539643339633566363839
          35653961363839613262303839386138316133316235396131643536323134373464306264383264
          63336363376331386664623534363162383362313061363632656166396363343734343232643063
          39666562383836343134346663376164323339326234666662616432646566303637333465303038
          62383032373334323830613937323436313334666436633666366133643366626265393561653034
          33653932623636623636643264373037633564373837396435363830376262346365633465333464
          64326238613134613633343137623966323031306433306138383563383134326430643436656331
          63383936373038633733383634633564376636393935333137626166316335343864323765316535
          34626431646538653537633834366662653761616537373165613662306230616366626161653562
          62383135326265396366643837626234343739306630636166666266336539663565663032393465
          30613830313361303732663865303266303531653965373163643333643234353565366539366363
          33383635373139343134313830333636353763353131616365326236353531316233656235376635
          32653530643032666631626335333765383664623131316562326332363531396565356530613364
          39613363643633353937653563383061366564626537323735333034323662333565383835353562
          36666133393766323265316161313035393265393735383836316130356161333438323564636261
          6437
        dest: "/home/{{ username }}/.ssh/id_rsa"
        owner: "{{ username }}"
        group: "{{ username }}"
        mode: '0600'

    - name: Set up authorized keys for the user 'joseph'
      ansible.builtin.authorized_key:
        user: "{{ username }}"
        state: present
        key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPBCiwplQnAvcndFW+wexuTWBOSqvkbMAXm/CCjxIHNj"

    - include_tasks: tasks/zsh.yml
    - include_tasks: tasks/dotfiles.yml
    - include_tasks: tasks/packages.yml
